# Пересоздание базы данных

## Когда нужно пересоздавать БД?

Пересоздание базы данных требуется, когда:
- Вы получаете ошибку о несуществующих колонках (например: `The column NPC.roleInScene does not exist`)
- Схема Prisma была обновлена, но миграции не были применены
- База данных находится в несогласованном состоянии

## ⚠️ ВНИМАНИЕ

**Пересоздание БД удалит все существующие данные!**
- Все проекты будут удалены
- Все NPC, сцены и энкаунтеры будут удалены
- Пользователи и их данные будут удалены

## Как пересоздать БД?

### Windows

1. Запустите скрипт:
   ```bash
   reset-db.bat
   ```

2. Подтвердите действие при запросе

3. Дождитесь завершения процесса

### Linux/Mac

1. Сделайте скрипт исполняемым (только первый раз):
   ```bash
   chmod +x reset-db.sh
   ```

2. Запустите скрипт:
   ```bash
   ./reset-db.sh
   ```

3. Подтвердите действие при запросе (введите `y`)

4. Дождитесь завершения процесса

## Что делает скрипт?

1. **Сброс БД**: Удаляет текущую базу данных
2. **Применение миграций**: Создает новую БД и применяет все миграции из папки `prisma/migrations/`
3. **Генерация клиента**: Обновляет Prisma Client для работы с новой схемой

## После пересоздания

1. Запустите приложение:
   - Windows: `start.bat`
   - Linux/Mac: `./start.sh`

2. Создайте нового пользователя через форму регистрации

3. Начните работу с чистой базой данных

## Альтернативный способ (вручную)

Если скрипт не работает, можно выполнить команды вручную:

```bash
# Сброс БД
npx prisma migrate reset --force

# Генерация клиента
npx prisma generate
```

## Решение проблем

### Ошибка "Database does not exist"
Это нормально при первом запуске. Prisma создаст новую БД автоматически.

### Ошибка подключения к БД
Проверьте:
- Настроен ли DATABASE_URL в `.env` файле
- Запущен ли сервер PostgreSQL (если используете PostgreSQL)
- Правильны ли данные подключения

### Скрипт не запускается
- Убедитесь, что установлен Node.js и npm
- Убедитесь, что установлены зависимости: `npm install`
- На Linux/Mac: проверьте права доступа: `chmod +x reset-db.sh`

