# üîç –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—Ç–ª–∞–¥–∫–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞–º–ø–∞–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞
JSON –æ—Ç–≤–µ—Ç –æ—Ç DeepSeek API –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –æ–¥–Ω–æ–º –ø–æ–ª–µ –∏ –Ω–µ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –º–∞—Å—Å–∏–≤—ã `scenes` –∏ `npcs`.

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤
- **–õ–∏–º–∏—Ç:** 8192 —Ç–æ–∫–µ–Ω–æ–≤ (–º–∞–∫—Å–∏–º—É–º –¥–ª—è DeepSeek API)
- **–ü—Ä–∏—á–∏–Ω–∞:** DeepSeek API –∏–º–µ–µ—Ç –∂–µ—Å—Ç–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ max_tokens –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [1, 8192]
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ü—Ä–æ–º–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∫—Ä–∞—Ç–∫–∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π (1-2 –∞–±–∑–∞—Ü–∞ –≤–º–µ—Å—Ç–æ 3-4)

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (PowerShell/cmd –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `npm run dev`) –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
=== DeepSeek API Call ===
Max tokens requested: 16000

=== DeepSeek Response ===
Tokens used: 12345
Completion tokens: 11000
Finish reason: stop

=== LLM Response ===
Length: 45678
First 500 chars: {"title":"–ü—Ä–æ–∫–ª—è—Ç–∏–µ...
Last 500 chars: ...}

=== Parsed Data ===
Title: –ü—Ä–æ–∫–ª—è—Ç–∏–µ –ö–æ—Å—Ç—è–Ω–æ–π –ë–∞—à–Ω–∏
Scenes count: 10
NPCs count: 5

=== Creating Scenes ===
Scenes array: [Array]
Is array: true
Processing 10 scenes
Creating scene: –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –ë–µ–∑—É–º–∏–µ
‚úì Scene created: –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –ë–µ–∑—É–º–∏–µ
...
Total scenes created: 10

=== Creating NPCs ===
NPCs array: [Array]
Is array: true
Processing 5 NPCs
Creating NPC: –≠–ª–º–∏–Ω—Å—Ç–µ—Ä –ú—É–¥—Ä—ã–π
‚úì NPC created: –≠–ª–º–∏–Ω—Å—Ç–µ—Ä –ú—É–¥—Ä—ã–π
...
Total NPCs created: 5
```

### 3. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON

–¢–µ–ø–µ—Ä—å –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç JSON –∏–∑ markdown-–±–ª–æ–∫–æ–≤ (```json ... ```)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –º–∞—Å—Å–∏–≤–æ–≤ `scenes` –∏ `npcs`
- –í—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
```bash
npm run dev
```

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å PowerShell
–°–ª–µ–¥–∏—Ç–µ –∑–∞ –≤—ã–≤–æ–¥–æ–º –ª–æ–≥–æ–≤ –≤ —Ç–æ–º –æ–∫–Ω–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ –∫–∞–º–ø–∞–Ω–∏—é
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞–º–ø–∞–Ω–∏–∏
3. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é"

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

**–ï—Å–ª–∏ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```
‚úÖ Finish reason: stop
‚úÖ Scenes count: 10
‚úÖ NPCs count: 5
‚úÖ Total scenes created: 10
‚úÖ Total NPCs created: 5
```

**–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è:**
```
‚ö†Ô∏è Response may be incomplete! Finish reason: length
‚ö†Ô∏è Scenes count: 0
‚ö†Ô∏è NPCs count: 0
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î
```bash
npm run db:studio
```

–û—Ç–∫—Ä–æ–π—Ç–µ:
- **Project** - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –∫–∞–º–ø–∞–Ω–∏—è
- **Scene** - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 10 —Å—Ü–µ–Ω
- **NPC** - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 5 NPC
- **Encounter** - –±–æ–µ–≤—ã–µ —ç–Ω–∫–∞—É–Ω—Ç–µ—Ä—ã (–µ—Å–ª–∏ –µ—Å—Ç—å combat —Å—Ü–µ–Ω—ã)

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Response may be incomplete" –∏–ª–∏ "finish_reason: length"
**–ü—Ä–∏—á–∏–Ω–∞:** DeepSeek –æ–±—Ä–µ–∑–∞–µ—Ç –æ—Ç–≤–µ—Ç, –¥–æ—Å—Ç–∏–≥–Ω—É–≤ –ª–∏–º–∏—Ç–∞ 8192 —Ç–æ–∫–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. ‚ö†Ô∏è **–ù–ï–õ–¨–ó–Ø** —É–≤–µ–ª–∏—á–∏—Ç—å maxTokens –≤—ã—à–µ 8192 (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ API)
2. ‚úÖ –£–ø—Ä–æ—Å—Ç–∏—Ç–µ –ø—Ä–æ–º–ø—Ç –≤ `src/lib/prompts.ts` - –ø–æ–ø—Ä–æ—Å–∏—Ç–µ –±–æ–ª–µ–µ –∫—Ä–∞—Ç–∫–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
3. ‚úÖ –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ü–µ–Ω/NPC (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 —Å—Ü–µ–Ω + 3 NPC)
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–æ–µ `atmosphericDescription`

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "Scenes count: 0"
**–ü—Ä–∏—á–∏–Ω–∞:** LLM –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ `scenes`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `First 500 chars` –∏ `Last 500 chars`
2. –í–æ–∑–º–æ–∂–Ω–æ JSON –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `JSON Parse Error`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –ø—Ä–æ–º–ø—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
**–ü—Ä–∏—á–∏–Ω–∞:** DeepSeek –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –≤ markdown –±–ª–æ–∫–µ –∏–ª–∏ —Å –ª–∏—à–Ω–∏–º —Ç–µ–∫—Å—Ç–æ–º

**–†–µ—à–µ–Ω–∏–µ:** –ö–æ–¥ —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç JSON –∏–∑ ```json ... ```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç DeepSeek
–í —Ñ–∞–π–ª–µ `src/app/api/generate/session/route.ts` –¥–æ–±–∞–≤—å—Ç–µ:

```typescript
console.log('RAW RESPONSE:', response.content);
```

### –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç –≤ —Ñ–∞–π–ª
```typescript
const fs = require('fs');
fs.writeFileSync('debug-response.json', response.content);
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ API
DeepSeek Dashboard: https://platform.deepseek.com/usage

## –ö–æ–Ω—Ç–∞–∫—Ç
–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç–≤–µ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `finish_reason`

