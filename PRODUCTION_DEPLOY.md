# üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Production

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

–ú–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤:
- **Vercel Postgres** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è Vercel –¥–µ–ø–ª–æ—è)
- **Supabase** (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)
- **Railway** (–ø—Ä–æ—Å—Ç–æ–π –¥–µ–ø–ª–æ–π)
- **Neon** (serverless PostgreSQL)

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ DATABASE_URL

–ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∞:
```
postgresql://username:password@host:5432/database_name?schema=public
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ DATABASE_URL
export DATABASE_URL="postgresql://..."

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate deploy
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã**

```bash
export DATABASE_URL="postgresql://..."
npx prisma db push
```

**–í–∞—Ä–∏–∞–Ω—Ç –í: –†—É—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SQL**

–ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –≤—Ä—É—á–Ω—É—é:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
psql $DATABASE_URL

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É:
# 1. prisma/migrations/20241014000000_init/migration.sql
# 2. prisma/migrations/20241014000001_add_npc_interaction_fields/migration.sql
# 3. prisma/migrations/20241021000000_add_quests_sessions_playercharacters/migration.sql
```

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:

```env
DATABASE_URL="postgresql://..."
```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ (—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω AI API –∫–ª—é—á):

```env
# DeepSeek (–¥–µ—à–µ–≤–ª–µ, ~$0.14-0.28/1M —Ç–æ–∫–µ–Ω–æ–≤)
DEEPSEEK_API_KEY="sk-..."

# OpenAI (–¥–ª—è DALL-E 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
OPENAI_API_KEY="sk-..."
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:

```env
NODE_ENV="production"
DEMO_USER_ID="demo-user-001"  # ID –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

---

## –î–µ–ø–ª–æ–π –Ω–∞ Vercel

### –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±:

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   ```bash
   vercel
   ```

2. **–î–æ–±–∞–≤—å—Ç–µ –ë–î:**
   - Vercel Dashboard ‚Üí Storage ‚Üí Create ‚Üí Postgres
   - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DATABASE_URL` –¥–æ–±–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

3. **–î–æ–±–∞–≤—å—Ç–µ API –∫–ª—é—á–∏:**
   - Settings ‚Üí Environment Variables
   - –î–æ–±–∞–≤—å—Ç–µ `DEEPSEEK_API_KEY` –∏ `OPENAI_API_KEY`

4. **–î–µ–ø–ª–æ–π:**
   ```bash
   vercel --prod
   ```

5. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
   ```bash
   # –ß–µ—Ä–µ–∑ Vercel CLI
   vercel env pull .env.production
   npx prisma migrate deploy
   ```

---

## –î–µ–ø–ª–æ–π –Ω–∞ Railway

1. **–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç:**
   - railway.app ‚Üí New Project ‚Üí Deploy from GitHub

2. **–î–æ–±–∞–≤—å—Ç–µ PostgreSQL:**
   - New ‚Üí Database ‚Üí PostgreSQL
   - `DATABASE_URL` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

3. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
   - Variables ‚Üí –¥–æ–±–∞–≤—å—Ç–µ `DEEPSEEK_API_KEY`, `OPENAI_API_KEY`

4. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –±–∏–ª–¥–µ

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü

### Quest (–ö–≤–µ—Å—Ç—ã)
- –ü—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –ø—Ä–æ–µ–∫—Ç–∞–º
- –¢–∏–ø—ã: investigation, rescue, escort, heist, defense, delivery, assassination, diplomatic
- –°–≤—è–∑–∏ —Å NPC –∏ —Å—Ü–µ–Ω–∞–º–∏
- –°—Ç–∞—Ç—É—Å—ã: available, active, completed, failed

### PlayerCharacter (–ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –∏–≥—Ä–æ–∫–æ–≤)
- –ü–æ–ª–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ D&D 5e
- HP, AC, —Å–∫–æ—Ä–æ—Å—Ç—å, –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞
- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ (JSON)
- –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è –¥–ª—è –∫–∞—Å—Ç–µ—Ä–æ–≤ (JSON)
- –ó–∞–º–µ—Ç–∫–∏ –º–∞—Å—Ç–µ—Ä–∞

### Session (–°–µ—Å—Å–∏–∏)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è
- –ó–∞–º–µ—Ç–∫–∏ –º–∞—Å—Ç–µ—Ä–∞
- –†–µ—à–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤
- –í—ã–¥–∞–Ω–Ω—ã–π XP –∏ –ª—É—Ç
- –ö–ª–∏—Ñ—Ñ—Ö—ç–Ω–≥–µ—Ä—ã
- –¶–µ–ª–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å–µ—Å—Å–∏—é

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. Health check

```bash
curl https://your-app.vercel.app/api/health/db
```

–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
```json
{"status":"ok","database":"connected"}
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç

–ó–∞–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç –∏:
- –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
- –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏–≥—Ä–æ–∫–∞
- –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å—å —Å–µ—Å—Å–∏–∏
- –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–≤–µ—Å—Ç

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ —Ñ–∏—á–∏

- ‚öñÔ∏è –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ —ç–Ω–∫–∞—É–Ω—Ç–µ—Ä–æ–≤
- üé≤ –°–ª—É—á–∞–π–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- ‚ö° –ü–∞–Ω–µ–ª—å –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏–∏
- üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç OPENAI_API_KEY)
- üìù –¢—Ä–µ–∫–µ—Ä —Å–µ—Å—Å–∏–π

---

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "DATABASE_URL not found"

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
echo $DATABASE_URL

# –î–ª—è Vercel
vercel env ls
```

### –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ "Table already exists"

```bash
# –°–±—Ä–æ—Å—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
npx prisma migrate resolve --applied "20241021000000_add_quests_sessions_playercharacters"

# –ò–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ë–î
npx prisma migrate reset  # –í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!
```

### –û—à–∏–±–∫–∞ "Module not found: @prisma/client"

```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ Prisma Client
npx prisma generate
```

---

## –ë—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö

### –î–ª—è SQLite (dev):

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –ë–î
cp prisma/dev.db prisma/dev.db.backup
```

### –î–ª—è PostgreSQL (production):

```bash
# –ß–µ—Ä–µ–∑ pg_dump
pg_dump $DATABASE_URL > backup.sql

# –î–ª—è Vercel Postgres
vercel postgres pull
```

---

## –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
# –û—Ç–∫–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate resolve --rolled-back "20241021000000_add_quests_sessions_playercharacters"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ
npx prisma migrate deploy
```

---

## –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è

- [ ] –°–æ–∑–¥–∞–Ω–∞ PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] DATABASE_URL –¥–æ–±–∞–≤–ª–µ–Ω –≤ environment variables
- [ ] DEEPSEEK_API_KEY –∏–ª–∏ OPENAI_API_KEY –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω `npm run build` –ª–æ–∫–∞–ª—å–Ω–æ (–ø—Ä–æ–≤–µ—Ä–∫–∞)
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É (Vercel/Railway/Render)
- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏: `npx prisma migrate deploy`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω health check: `/api/health/db`
- [ ] –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
- [ ] –í—Å–µ —Ñ–∏—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

---

**–ì–æ—Ç–æ–≤–æ –∫ production! üöÄ**

